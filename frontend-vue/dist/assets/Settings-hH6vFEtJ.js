import{d as z,r as b,Z as A,c as F,b as r,e,h as o,k as $,l as y,A as X,E as Z,ak as G,al as H,O as K,s as P,m as Q,v as d,x as W,y as i,am as C,u as Y,an as ee,ao as te,ap as oe,aq as le,C as O,f as S,g as ae,ar as ne,as as se,i as re,X as n,at as de,_ as ce}from"./index-BCQt_NF5.js";import{a as h}from"./api-DESwUr0w.js";/* empty css                 *//* empty css                   */const ue={class:"page-container"},ie={style:{"margin-bottom":"16px"}},_e=z({__name:"Settings",setup(me){const v=b(),R=b(),k=b(!1),_=b(null),w=b(!1),l=A({mongodb_url:"mongodb://localhost:27017",database_name:"sql_results",slow_sql_threshold:1e3,default_collection:"",page_size:20}),V={mongodb_url:[{required:!0,message:"请输入MongoDB连接地址"},{pattern:/^mongodb:\/\//,message:"请输入有效的MongoDB连接地址"}],database_name:[{required:!0,message:"请输入数据库名称"}]},j=async()=>{if(!l.mongodb_url){n.error("请输入MongoDB连接地址");return}w.value=!0;try{const a=await h.testConnection(l);_.value=a,a.success?n.success("连接测试成功"):n.error(`连接测试失败: ${a.message}`)}catch{const t={success:!1,message:"连接测试异常"};_.value=t,n.error("连接测试异常")}finally{w.value=!1}},D=async()=>{try{await v.value.validate(),await h.saveSettings(l),n.success("设置已保存"),localStorage.setItem("sql_plan_visualizer_settings",JSON.stringify(l)),window.dispatchEvent(new StorageEvent("storage",{key:"sql_plan_visualizer_settings"}))}catch(a){console.error("保存设置失败:",a),n.error("保存设置失败")}},U=async()=>{try{try{const t=await h.getSettings();Object.assign(l,t),n.success("已加载服务器设置");return}catch(t){console.log("从服务器加载设置失败，尝试从本地加载:",t)}const a=localStorage.getItem("sql_plan_visualizer_settings");if(a){const t=JSON.parse(a);Object.assign(l,t),n.success("已加载本地保存的设置")}else n.info("没有找到保存的设置")}catch(a){console.error("加载设置失败:",a),n.error("加载设置失败")}},q=()=>{de.confirm("确定要重置所有设置吗？","确认重置",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Object.assign(l,{mongodb_url:"mongodb://localhost:27017",database_name:"sql_results",slow_sql_threshold:100,default_collection:"",page_size:20}),_.value=null,n.success("设置已重置")}).catch(()=>{})},N=()=>{try{const a={mongodb_url:l.mongodb_url,database_name:l.database_name,default_collection:l.default_collection,export_time:new Date().toISOString(),version:"1.0"},t=JSON.stringify(a,null,2),c=new Blob([t],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(c),s.download=`mongodb_config_${new Date().getTime()}.json`,s.click(),URL.revokeObjectURL(s.href),n.success("配置导出成功")}catch(a){console.error("导出配置失败:",a),n.error("导出配置失败")}},I=a=>{try{const t=new FileReader;t.onload=c=>{var s;try{const m=(s=c.target)==null?void 0:s.result,u=JSON.parse(m);if(!u.mongodb_url||!u.database_name){n.error("配置文件格式不正确，缺少必要字段");return}l.mongodb_url=u.mongodb_url,l.database_name=u.database_name,u.default_collection!==void 0&&(l.default_collection=u.default_collection),n.success("配置导入成功")}catch(m){console.error("解析配置文件失败:",m),n.error("配置文件格式错误，无法解析")}},t.onerror=()=>{n.error("读取配置文件失败")},t.readAsText(a.raw)}catch(t){console.error("导入配置失败:",t),n.error("导入配置失败")}},L=async()=>{try{await v.value.validate();const a={mongodb_url:l.mongodb_url,database_name:l.database_name,default_collection:l.default_collection,save_time:new Date().toISOString(),version:"1.0"},t=JSON.stringify(a,null,2),c=new Blob([t],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(c),s.download=`mongodb_config_backup_${new Date().getTime()}.json`,s.click(),URL.revokeObjectURL(s.href),n.success("配置保存成功")}catch(a){console.error("保存配置失败:",a),n.error("保存配置失败")}};return(a,t)=>{const c=W,s=Q,m=K,u=H,E=P,f=Y,g=X,M=te,B=$,J=G,x=Z,T=re;return y(),F("div",ue,[t[15]||(t[15]=r("div",{class:"page-header"},[r("h2",{class:"page-title"},"设置"),r("p",{class:"page-description"},"配置MongoDB连接和应用参数")],-1)),e(B,{gutter:24},{default:o(()=>[e(g,{xs:24,lg:16},{default:o(()=>[e(x,{class:"card-container"},{header:o(()=>[e(s,null,{default:o(()=>[e(c,null,{default:o(()=>[e(i(O))]),_:1}),t[3]||(t[3]=d(" 数据库配置 ",-1))]),_:1})]),default:o(()=>[e(J,{ref_key:"formRef",ref:v,model:l,rules:V,"label-width":"120px","label-position":"top"},{default:o(()=>[e(u,{label:"MongoDB连接地址",prop:"mongodb_url"},{default:o(()=>[e(m,{modelValue:l.mongodb_url,"onUpdate:modelValue":t[0]||(t[0]=p=>l.mongodb_url=p),placeholder:"mongodb://localhost:27017"},null,8,["modelValue"])]),_:1}),e(u,{label:"数据库名称",prop:"database_name"},{default:o(()=>[e(m,{modelValue:l.database_name,"onUpdate:modelValue":t[1]||(t[1]=p=>l.database_name=p),placeholder:"sql_results"},null,8,["modelValue"])]),_:1}),e(u,{label:"默认集合",prop:"default_collection"},{default:o(()=>[e(m,{modelValue:l.default_collection,"onUpdate:modelValue":t[2]||(t[2]=p=>l.default_collection=p),placeholder:"留空则显示所有集合"},null,8,["modelValue"])]),_:1}),e(E),r("h4",ie,[e(s,null,{default:o(()=>[e(c,null,{default:o(()=>[e(i(C))]),_:1}),t[4]||(t[4]=d(" 数据库连接配置管理 ",-1))]),_:1})]),e(B,{gutter:16},{default:o(()=>[e(g,{xs:24,sm:8},{default:o(()=>[e(u,null,{default:o(()=>[e(f,{type:"primary",onClick:N,disabled:!l.mongodb_url,style:{width:"100%"}},{default:o(()=>[e(c,null,{default:o(()=>[e(i(ee))]),_:1}),t[5]||(t[5]=d(" 导出配置 ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1}),e(g,{xs:24,sm:8},{default:o(()=>[e(u,null,{default:o(()=>[e(M,{ref_key:"uploadRef",ref:R,"auto-upload":!1,"show-file-list":!1,accept:".json",onChange:I,style:{width:"100%"}},{default:o(()=>[e(f,{type:"success",style:{width:"100%"}},{default:o(()=>[e(c,null,{default:o(()=>[e(i(oe))]),_:1}),t[6]||(t[6]=d(" 导入配置 ",-1))]),_:1})]),_:1},512)]),_:1})]),_:1}),e(g,{xs:24,sm:8},{default:o(()=>[e(u,null,{default:o(()=>[e(f,{type:"warning",onClick:L,loading:k.value,style:{width:"100%"}},{default:o(()=>[e(c,null,{default:o(()=>[e(i(le))]),_:1}),t[7]||(t[7]=d(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),e(E),e(u,null,{default:o(()=>[e(s,null,{default:o(()=>[e(f,{type:"primary",onClick:D,loading:k.value},{default:o(()=>[...t[8]||(t[8]=[d(" 保存设置 ",-1)])]),_:1},8,["loading"]),e(f,{onClick:U},{default:o(()=>[...t[9]||(t[9]=[d(" 加载保存的设置 ",-1)])]),_:1}),e(f,{onClick:q},{default:o(()=>[...t[10]||(t[10]=[d(" 重置设置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(g,{xs:24,lg:8},{default:o(()=>[e(x,{class:"card-container"},{header:o(()=>[e(s,null,{default:o(()=>[e(c,null,{default:o(()=>[e(i(C))]),_:1}),t[11]||(t[11]=d(" 连接测试 ",-1))]),_:1})]),default:o(()=>[t[13]||(t[13]=r("p",{style:{color:"#a1a1aa","margin-bottom":"16px"}}," 测试MongoDB连接是否正常 ",-1)),_.value?(y(),S(T,{key:0,title:_.value.success?"连接成功":"连接失败",description:_.value.message,type:_.value.success?"success":"error",style:{"margin-bottom":"16px"}},{icon:o(()=>[_.value.success?(y(),S(c,{key:0},{default:o(()=>[e(i(ne))]),_:1})):(y(),S(c,{key:1},{default:o(()=>[e(i(se))]),_:1}))]),_:1},8,["title","description","type"])):ae("",!0),e(f,{type:"primary",style:{width:"100%"},loading:w.value,onClick:j},{default:o(()=>[e(c,null,{default:o(()=>[e(i(O))]),_:1}),t[12]||(t[12]=d(" 测试连接 ",-1))]),_:1},8,["loading"])]),_:1}),e(x,{title:"使用说明",style:{"margin-top":"24px"}},{default:o(()=>[...t[14]||(t[14]=[r("div",{style:{"font-size":"14px","line-height":"1.6",color:"#a1a1aa"}},[r("h4",{style:{color:"#e4e4e7","margin-bottom":"8px"}},"MongoDB连接格式："),r("p",{style:{"margin-bottom":"12px"}},[d(" • 本地连接：mongodb://localhost:27017"),r("br"),d(" • 带认证：mongodb://username:password@localhost:27017"),r("br"),d(" • 远程连接：mongodb://server:port ")]),r("h4",{style:{color:"#e4e4e7","margin-bottom":"8px"}},"数据集合："),r("p",{style:{"margin-bottom":"12px"}}," 系统会自动列出数据库中的所有集合，您可以选择要分析的数据集合。 "),r("h4",{style:{color:"#e4e4e7","margin-bottom":"8px"}},"配置管理："),r("p",null,[d(" • 导出配置：将当前数据库连接配置保存为JSON文件"),r("br"),d(" • 导入配置：从JSON文件加载数据库连接配置"),r("br"),d(" • 保存配置：创建配置文件的备份副本 ")])],-1)])]),_:1})]),_:1})]),_:1})])}}}),ye=ce(_e,[["__scopeId","data-v-5e945eb8"]]);export{ye as default};
